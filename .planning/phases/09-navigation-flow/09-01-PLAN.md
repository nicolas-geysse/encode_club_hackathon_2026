---
phase: 09-navigation-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/src/lib/onboardingStateStore.ts
  - packages/frontend/src/components/layout/Sidebar.tsx
  - packages/frontend/src/components/layout/BottomNav.tsx
  - packages/frontend/src/components/chat/OnboardingChat.tsx
autonomous: true

must_haves:
  truths:
    - "During onboarding, only Onboarding link is visible in Sidebar"
    - "During onboarding, only Onboarding link is visible in BottomNav"
    - "After onboarding completes, My Plan, Tracking, Debug appear in nav"
    - "New nav items appear with smooth reveal animation"
  artifacts:
    - path: "packages/frontend/src/lib/onboardingStateStore.ts"
      provides: "Shared onboarding completion state"
      exports: ["onboardingIsComplete", "setOnboardingComplete", "persistOnboardingComplete"]
    - path: "packages/frontend/src/components/layout/Sidebar.tsx"
      provides: "Conditional nav rendering"
      contains: "onboardingIsComplete"
    - path: "packages/frontend/src/components/layout/BottomNav.tsx"
      provides: "Conditional nav rendering for mobile"
      contains: "onboardingIsComplete"
  key_links:
    - from: "packages/frontend/src/components/chat/OnboardingChat.tsx"
      to: "onboardingStateStore.ts"
      via: "imports onboardingIsComplete as isComplete alias, replaces local signal"
      pattern: "onboardingIsComplete"
    - from: "packages/frontend/src/components/layout/Sidebar.tsx"
      to: "onboardingStateStore.ts"
      via: "onboardingIsComplete accessor subscription"
      pattern: "onboardingIsComplete\\(\\)"
---

<objective>
Implement conditional navigation visibility based on onboarding completion state.

Purpose: Users should only see the Onboarding link during setup to avoid confusion. After completing onboarding, other navigation options (My Plan, Tracking, Debug) should appear with a smooth reveal animation.

Output: Shared state store, updated Sidebar/BottomNav with conditional rendering and animations.
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/frontend/src/components/layout/Sidebar.tsx
@packages/frontend/src/components/layout/BottomNav.tsx
@packages/frontend/src/components/chat/OnboardingChat.tsx (lines 200-230 for isComplete signal)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared onboarding state store</name>
  <files>packages/frontend/src/lib/onboardingStateStore.ts</files>
  <action>
Create a simple SolidJS store to share onboarding completion state across components:

```typescript
import { createSignal, type Accessor } from 'solid-js';

// Shared onboarding state - allows Sidebar/BottomNav to react to onboarding completion
const [isComplete, setIsComplete] = createSignal(false);

// Export as accessor for reactive reads in components
export const onboardingIsComplete: Accessor<boolean> = isComplete;

export const setOnboardingComplete = (complete: boolean) => {
  setIsComplete(complete);
};

// Initialize from localStorage on load (for page refresh persistence)
if (typeof window !== 'undefined') {
  const stored = localStorage.getItem('onboardingComplete');
  if (stored === 'true') {
    setIsComplete(true);
  }
}

export const persistOnboardingComplete = (complete: boolean) => {
  setOnboardingComplete(complete);
  if (typeof window !== 'undefined') {
    localStorage.setItem('onboardingComplete', String(complete));
  }
};
```
  </action>
  <verify>File exists and exports `onboardingIsComplete`, `setOnboardingComplete`, `persistOnboardingComplete`</verify>
  <done>Shared state store created for onboarding completion state</done>
</task>

<task type="auto">
  <name>Task 2: Update Sidebar with conditional nav visibility</name>
  <files>packages/frontend/src/components/layout/Sidebar.tsx</files>
  <action>
Modify Sidebar.tsx to conditionally show nav items based on onboarding state:

1. Import the onboarding accessor:
   ```typescript
   import { onboardingIsComplete } from '~/lib/onboardingStateStore';
   ```

2. Create a derived signal for visible nav items:
   ```typescript
   const visibleNavItems = () => {
     if (!onboardingIsComplete()) {
       // During onboarding: only show Onboarding link
       return navItems.filter(item => item.href === '/');
     }
     // After onboarding: show all items
     return navItems;
   };
   ```

3. Replace `<For each={navItems}>` with `<For each={visibleNavItems()}>`

4. Add reveal animation using transition classes (proven to work in this codebase):
   - Use `transition-all duration-300 ease-out` for smooth animations
   - Use `opacity-0` initial state with `opacity-100` for fade-in effect

5. For staggered animation, use index-based delay (note: index is an Accessor in SolidJS For):
   ```tsx
   <For each={visibleNavItems()}>
     {(item, i) => {
       const isActive = () => item.href && location.pathname === item.href;
       // Only apply animation delay after onboarding completes
       const animStyle = () => onboardingIsComplete() ? {
         'animation-delay': `${i() * 75}ms`,
         'animation-fill-mode': 'both'
       } : {};
       return (
         // ... existing Show/A structure
         // Add style={animStyle()} and class="animate-fade-in" (uses CSS variable from app.css)
       );
     }}
   </For>
   ```
  </action>
  <verify>
    - `grep -n "onboardingIsComplete" packages/frontend/src/components/layout/Sidebar.tsx` shows import and usage
    - `grep -n "visibleNavItems" packages/frontend/src/components/layout/Sidebar.tsx` shows filtering logic
  </verify>
  <done>Sidebar shows only Onboarding link during onboarding, reveals all links with animation after completion</done>
</task>

<task type="auto">
  <name>Task 3: Update BottomNav with same conditional visibility</name>
  <files>packages/frontend/src/components/layout/BottomNav.tsx</files>
  <action>
Apply the same pattern to BottomNav.tsx for mobile:

1. Import onboarding accessor:
   ```typescript
   import { onboardingIsComplete } from '~/lib/onboardingStateStore';
   ```

2. Add visibleNavItems derived signal (same logic as Sidebar):
   ```typescript
   const visibleNavItems = () => {
     if (!onboardingIsComplete()) {
       return navItems.filter(item => item.href === '/');
     }
     return navItems;
   };
   ```

3. Replace `<For each={navItems}>` with `<For each={visibleNavItems()}>`

4. Add subtle reveal animation (simpler than desktop - just opacity fade):
   ```tsx
   <For each={visibleNavItems()}>
     {(item, i) => {
       // ... existing logic
       const animStyle = () => onboardingIsComplete() ? {
         'animation-delay': `${i() * 50}ms`,
         'animation-fill-mode': 'both'
       } : {};
       // Add style={animStyle()} and class="animate-fade-in" to button/A elements
     }}
   </For>
   ```
  </action>
  <verify>
    - `grep -n "onboardingIsComplete" packages/frontend/src/components/layout/BottomNav.tsx` shows import and usage
    - Mobile nav conditionally hides items during onboarding
  </verify>
  <done>BottomNav mirrors Sidebar conditional visibility with reveal animation</done>
</task>

<task type="auto">
  <name>Task 4: Wire OnboardingChat to update shared state (REPLACE local signal)</name>
  <files>packages/frontend/src/components/chat/OnboardingChat.tsx</files>
  <action>
REPLACE OnboardingChat's local isComplete signal with the shared store to avoid duplicate state:

1. Import the shared store functions and accessor:
   ```typescript
   import { onboardingIsComplete, setOnboardingComplete, persistOnboardingComplete } from '~/lib/onboardingStateStore';
   ```

2. REMOVE the local signal definition (around line 227):
   ```typescript
   // DELETE THIS LINE: const [isComplete, setIsComplete] = createSignal(false);
   ```

3. Create a local alias to maintain code compatibility:
   ```typescript
   // Use shared store - isComplete reads from store, setIsComplete updates store + persists
   const isComplete = onboardingIsComplete;
   const setIsComplete = (value: boolean) => {
     persistOnboardingComplete(value);  // This updates store AND localStorage
   };
   ```

4. This approach:
   - Keeps ALL existing setIsComplete(true/false) calls working unchanged
   - Removes duplicate state (local signal + shared store)
   - Sidebar/BottomNav will automatically react to changes via onboardingIsComplete

5. Verify the initialization logic (around lines 261-283) still works:
   - When chat history shows completion, setIsComplete(true) will now persist to store
   - On page refresh, the store initializes from localStorage (handled in store file)
  </action>
  <verify>
    - `grep -n "onboardingIsComplete" packages/frontend/src/components/chat/OnboardingChat.tsx` shows import
    - `grep -n "const.*isComplete.*createSignal" packages/frontend/src/components/chat/OnboardingChat.tsx` returns NO matches (local signal removed)
    - All setIsComplete calls still exist and work through the alias
  </verify>
  <done>OnboardingChat uses shared store directly, no duplicate state between local signal and store</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes:
   ```bash
   pnpm --filter @stride/frontend typecheck
   ```

2. Lint passes:
   ```bash
   pnpm --filter @stride/frontend lint
   ```

3. State store exports correct:
   ```bash
   grep -E "export (const|function)" packages/frontend/src/lib/onboardingStateStore.ts
   ```

4. Sidebar uses conditional rendering:
   ```bash
   grep "visibleNavItems" packages/frontend/src/components/layout/Sidebar.tsx
   grep "onboardingIsComplete" packages/frontend/src/components/layout/Sidebar.tsx
   ```

5. BottomNav uses conditional rendering:
   ```bash
   grep "visibleNavItems" packages/frontend/src/components/layout/BottomNav.tsx
   grep "onboardingIsComplete" packages/frontend/src/components/layout/BottomNav.tsx
   ```

6. OnboardingChat uses shared state (local signal REMOVED):
   ```bash
   grep "onboardingIsComplete" packages/frontend/src/components/chat/OnboardingChat.tsx
   # Should NOT find local createSignal for isComplete:
   grep -c "const.*isComplete.*createSignal" packages/frontend/src/components/chat/OnboardingChat.tsx  # expect 0
   ```
</verification>

<success_criteria>
- onboardingStateStore.ts exists with shared completion state (exports onboardingIsComplete accessor)
- Sidebar.tsx filters nav items based on onboarding state via onboardingIsComplete()
- BottomNav.tsx filters nav items based on onboarding state via onboardingIsComplete()
- OnboardingChat.tsx REPLACES local isComplete signal with shared store (no duplicate state)
- TypeScript and lint checks pass
- New nav items have reveal animation using animate-fade-in class (CSS variable from app.css)
</success_criteria>

<output>
After completion, create `.planning/phases/09-navigation-flow/09-01-SUMMARY.md`
</output>
