---
phase: 09-navigation-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/src/lib/onboardingStateStore.ts
  - packages/frontend/src/components/layout/Sidebar.tsx
  - packages/frontend/src/components/layout/BottomNav.tsx
  - packages/frontend/src/components/chat/OnboardingChat.tsx
autonomous: true

must_haves:
  truths:
    - "During onboarding, only Onboarding link is visible in Sidebar"
    - "During onboarding, only Onboarding link is visible in BottomNav"
    - "After onboarding completes, My Plan, Tracking, Debug appear in nav"
    - "New nav items appear with smooth reveal animation"
  artifacts:
    - path: "packages/frontend/src/lib/onboardingStateStore.ts"
      provides: "Shared onboarding completion state"
      exports: ["onboardingStore", "setOnboardingComplete"]
    - path: "packages/frontend/src/components/layout/Sidebar.tsx"
      provides: "Conditional nav rendering"
      contains: "onboardingStore"
    - path: "packages/frontend/src/components/layout/BottomNav.tsx"
      provides: "Conditional nav rendering for mobile"
      contains: "onboardingStore"
  key_links:
    - from: "packages/frontend/src/components/chat/OnboardingChat.tsx"
      to: "onboardingStateStore.ts"
      via: "setOnboardingComplete call when onboarding finishes"
      pattern: "setOnboardingComplete\\(true\\)"
    - from: "packages/frontend/src/components/layout/Sidebar.tsx"
      to: "onboardingStateStore.ts"
      via: "onboardingStore signal subscription"
      pattern: "onboardingStore\\.isComplete"
---

<objective>
Implement conditional navigation visibility based on onboarding completion state.

Purpose: Users should only see the Onboarding link during setup to avoid confusion. After completing onboarding, other navigation options (My Plan, Tracking, Debug) should appear with a smooth reveal animation.

Output: Shared state store, updated Sidebar/BottomNav with conditional rendering and animations.
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/frontend/src/components/layout/Sidebar.tsx
@packages/frontend/src/components/layout/BottomNav.tsx
@packages/frontend/src/components/chat/OnboardingChat.tsx (lines 200-230 for isComplete signal)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared onboarding state store</name>
  <files>packages/frontend/src/lib/onboardingStateStore.ts</files>
  <action>
Create a simple SolidJS store to share onboarding completion state across components:

```typescript
import { createSignal } from 'solid-js';

// Shared onboarding state - allows Sidebar/BottomNav to react to onboarding completion
const [isComplete, setIsComplete] = createSignal(false);

export const onboardingStore = {
  get isComplete() { return isComplete(); },
};

export const setOnboardingComplete = (complete: boolean) => {
  setIsComplete(complete);
};

// Initialize from localStorage on load (for page refresh persistence)
if (typeof window !== 'undefined') {
  const stored = localStorage.getItem('onboardingComplete');
  if (stored === 'true') {
    setIsComplete(true);
  }
}

export const persistOnboardingComplete = (complete: boolean) => {
  setOnboardingComplete(complete);
  if (typeof window !== 'undefined') {
    localStorage.setItem('onboardingComplete', String(complete));
  }
};
```
  </action>
  <verify>File exists and exports `onboardingStore`, `setOnboardingComplete`, `persistOnboardingComplete`</verify>
  <done>Shared state store created for onboarding completion state</done>
</task>

<task type="auto">
  <name>Task 2: Update Sidebar with conditional nav visibility</name>
  <files>packages/frontend/src/components/layout/Sidebar.tsx</files>
  <action>
Modify Sidebar.tsx to conditionally show nav items based on onboarding state:

1. Import the onboarding store:
   ```typescript
   import { onboardingStore } from '~/lib/onboardingStateStore';
   ```

2. Create a derived signal for visible nav items:
   ```typescript
   const visibleNavItems = () => {
     if (!onboardingStore.isComplete) {
       // During onboarding: only show Onboarding link
       return navItems.filter(item => item.href === '/');
     }
     // After onboarding: show all items
     return navItems;
   };
   ```

3. Replace `<For each={navItems}>` with `<For each={visibleNavItems()}>`

4. Add reveal animation class to nav items (in the nav container or items):
   - Add `animate-slide-in-left` or use Tailwind's `animate-fade-in` with staggered delays
   - Use transition classes: `transition-all duration-300 ease-out`

5. For staggered animation, use index-based delay:
   ```tsx
   <For each={visibleNavItems()}>
     {(item, index) => {
       const isActive = () => item.href && location.pathname === item.href;
       const animDelay = () => onboardingStore.isComplete ? `${index() * 75}ms` : '0ms';
       return (
         // ... existing Show/A structure
         // Add style={{ 'animation-delay': animDelay() }} and class="animate-fade-in"
       );
     }}
   </For>
   ```
  </action>
  <verify>
    - `grep -n "onboardingStore" packages/frontend/src/components/layout/Sidebar.tsx` shows import and usage
    - `grep -n "visibleNavItems" packages/frontend/src/components/layout/Sidebar.tsx` shows filtering logic
  </verify>
  <done>Sidebar shows only Onboarding link during onboarding, reveals all links with animation after completion</done>
</task>

<task type="auto">
  <name>Task 3: Update BottomNav with same conditional visibility</name>
  <files>packages/frontend/src/components/layout/BottomNav.tsx</files>
  <action>
Apply the same pattern to BottomNav.tsx for mobile:

1. Import onboarding store:
   ```typescript
   import { onboardingStore } from '~/lib/onboardingStateStore';
   ```

2. Add visibleNavItems derived signal (same logic as Sidebar)

3. Replace `<For each={navItems}>` with `<For each={visibleNavItems()}>`

4. Add subtle reveal animation (can be simpler than desktop - just opacity fade):
   ```tsx
   <For each={visibleNavItems()}>
     {(item, index) => {
       // ... existing logic
       const animDelay = () => onboardingStore.isComplete ? `${index() * 50}ms` : '0ms';
       // Add style and animation class to button/A elements
     }}
   </For>
   ```
  </action>
  <verify>
    - `grep -n "onboardingStore" packages/frontend/src/components/layout/BottomNav.tsx` shows import and usage
    - Mobile nav conditionally hides items during onboarding
  </verify>
  <done>BottomNav mirrors Sidebar conditional visibility with reveal animation</done>
</task>

<task type="auto">
  <name>Task 4: Wire OnboardingChat to update shared state</name>
  <files>packages/frontend/src/components/chat/OnboardingChat.tsx</files>
  <action>
Connect OnboardingChat's isComplete signal to the shared store:

1. Import the persist function:
   ```typescript
   import { persistOnboardingComplete } from '~/lib/onboardingStateStore';
   ```

2. Find the places where `setIsComplete(true)` is called (search for `setIsComplete`).
   Add a call to `persistOnboardingComplete(true)` right after each `setIsComplete(true)`:

   - Around line 261-262: after checking chat history for completion
   - Around line 283-284: after localStorage fallback completion check
   - Around line 1104: when profile is complete
   - Around line 2083: when transitioning to conversation mode

3. Also update the restart handler (around line 2522) to reset the store:
   ```typescript
   setIsComplete(false);
   persistOnboardingComplete(false);
   ```

4. On component mount (in existing onMount or createEffect), sync initial state:
   ```typescript
   // If already complete from localStorage, sync to store
   if (isComplete()) {
     persistOnboardingComplete(true);
   }
   ```
  </action>
  <verify>
    - `grep -n "persistOnboardingComplete" packages/frontend/src/components/chat/OnboardingChat.tsx` shows calls
    - Restart handler includes `persistOnboardingComplete(false)`
  </verify>
  <done>OnboardingChat syncs completion state to shared store, enabling nav visibility updates</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes:
   ```bash
   pnpm --filter @stride/frontend typecheck
   ```

2. Lint passes:
   ```bash
   pnpm --filter @stride/frontend lint
   ```

3. State store exports correct:
   ```bash
   grep -E "export (const|function)" packages/frontend/src/lib/onboardingStateStore.ts
   ```

4. Sidebar uses conditional rendering:
   ```bash
   grep "visibleNavItems" packages/frontend/src/components/layout/Sidebar.tsx
   ```

5. BottomNav uses conditional rendering:
   ```bash
   grep "visibleNavItems" packages/frontend/src/components/layout/BottomNav.tsx
   ```

6. OnboardingChat updates shared state:
   ```bash
   grep "persistOnboardingComplete" packages/frontend/src/components/chat/OnboardingChat.tsx
   ```
</verification>

<success_criteria>
- onboardingStateStore.ts exists with shared completion state
- Sidebar.tsx filters nav items based on onboarding state
- BottomNav.tsx filters nav items based on onboarding state
- OnboardingChat.tsx calls persistOnboardingComplete on completion/restart
- TypeScript and lint checks pass
- New nav items have reveal animation (fade-in or slide-in)
</success_criteria>

<output>
After completion, create `.planning/phases/09-navigation-flow/09-01-SUMMARY.md`
</output>
