---
phase: 03-embed-route
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/src/app.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Visiting /embed/swipe renders SwipeTab without header, sidebar, or navigation"
    - "Non-embed routes continue to render with full AppLayout chrome"
    - "Embed route works correctly in iframe without double navigation"
  artifacts:
    - path: "packages/frontend/src/app.tsx"
      provides: "Conditional layout exclusion for /embed/* routes"
      contains: "isEmbedRoute"
  key_links:
    - from: "packages/frontend/src/app.tsx"
      to: "useLocation"
      via: "path detection for embed routes"
      pattern: "location\\.pathname\\.startsWith.*embed"
---

<objective>
Fix layout exclusion gap so /embed/* routes render without AppLayout chrome.

Purpose: EMBD-02 failed verification because all routes are wrapped in AppLayout. Embed routes intended for iframe embedding must bypass the header, sidebar, and navigation to avoid double chrome.

Output: Modified app.tsx with conditional layout logic that renders children directly for /embed/* routes.
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-embed-route/VERIFICATION.md
@packages/frontend/src/app.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add conditional layout exclusion for embed routes</name>
  <files>packages/frontend/src/app.tsx</files>
  <action>
Update app.tsx to conditionally bypass AppLayout for /embed/* routes:

1. Import `useLocation` from `@solidjs/router` (add to existing Router import line)
2. Import `Show` from `solid-js` (add to existing solid-js import line)
3. Inside the Router's root prop function, before rendering AppLayout:
   - Call `const location = useLocation();`
   - Create reactive check: `const isEmbedRoute = () => location.pathname.startsWith('/embed');`
4. Wrap the AppLayout in a Show component:
   - `<Show when={!isEmbedRoute()} fallback={<Suspense>...</Suspense>{props.children}</Suspense>}>`
   - The fallback renders just the Suspense wrapper with props.children directly (no AppLayout)
   - The Show's children render the existing AppLayout wrapper

IMPORTANT: Keep all existing providers (ThemeProvider, SimulationProvider, ProfileProvider) outside the conditional - only AppLayout should be conditionally rendered.

The fallback should include:
- The same Suspense fallback loading spinner as the main branch
- props.children directly (no AppLayout, no header, no sidebar, no bottom nav)
  </action>
  <verify>
1. Run `pnpm --filter @stride/frontend typecheck` - must pass with no errors
2. Run `pnpm dev` and visit http://localhost:3006/embed/swipe
   - Page should render SwipeTab component only
   - No header visible (no SimulationControls, ProfileSelector, ThemeToggle, NotificationBell)
   - No sidebar visible (desktop)
   - No bottom navigation visible (mobile)
3. Visit http://localhost:3006/plan
   - Page should render with full AppLayout chrome (header, sidebar, etc.)
  </verify>
  <done>
- /embed/swipe renders SwipeTab without any navigation chrome
- /plan and other routes render with full AppLayout
- TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
After task completion:

1. **TypeScript:** `pnpm --filter @stride/frontend typecheck` passes
2. **Embed route (desktop):** No header, no sidebar at /embed/swipe
3. **Embed route (mobile):** No header, no bottom navigation at /embed/swipe
4. **Normal routes:** Full chrome remains at /, /plan, /suivi
5. **Providers work:** Profile context, theme, simulation still function on embed route
</verification>

<success_criteria>
- EMBD-02 verification gap is closed
- Embed route is iframe-ready (no double chrome)
- All 3 phase success criteria now pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-embed-route/03-02-SUMMARY.md`
</output>
