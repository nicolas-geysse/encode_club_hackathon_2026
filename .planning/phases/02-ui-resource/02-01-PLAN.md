---
phase: 02-ui-resource
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/src/types/chat.ts
  - packages/frontend/src/routes/api/chat.ts
autonomous: true

must_haves:
  truths:
    - "API returns swipe_embed UIResource when user says 'swipe' or 'actions'"
    - "UIResource contains embedUrl pointing to /embed/swipe"
    - "UIResource contains fallbackUrl pointing to /plan?tab=swipe"
    - "UIResource includes height of 450 (default)"
  artifacts:
    - path: "packages/frontend/src/types/chat.ts"
      provides: "swipe_embed UIResource type definition"
      contains: "type: 'swipe_embed'"
    - path: "packages/frontend/src/routes/api/chat.ts"
      provides: "swipe_embed UIResource generation on show_swipe_embed action"
      contains: "case 'show_swipe_embed'"
  key_links:
    - from: "packages/frontend/src/routes/api/chat.ts"
      to: "packages/frontend/src/types/chat.ts"
      via: "UIResource type import"
      pattern: "import.*UIResource.*from.*types/chat"
---

<objective>
Add swipe_embed UIResource type and API handler for swipe intent detection.

Purpose: When user triggers swipe intent ("swipe", "actions", "strategies"), the chat API must return a structured UIResource that the frontend can render as an embedded iframe (desktop) or navigation button (mobile).

Output:
- New swipe_embed type in UIResource union
- Handler case in chat.ts switch statement for show_swipe_embed action
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-intent-detection/01-01-SUMMARY.md

# Key files for reference
@packages/frontend/src/types/chat.ts (UIResource type union - add swipe_embed variant)
@packages/frontend/src/routes/api/chat.ts (chat API - add show_swipe_embed case around line 1640)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add swipe_embed type to UIResource union</name>
  <files>packages/frontend/src/types/chat.ts</files>
  <action>
Add a new variant to the UIResource type union for swipe embed. Place it after the 'chart' type (around line 105).

The new type should be:
```typescript
| {
    type: 'swipe_embed';
    params: {
      /** URL for iframe embedding */
      embedUrl: string;
      /** Fallback URL for mobile/navigation */
      fallbackUrl: string;
      /** Height in pixels for iframe (default 450) */
      height: number;
      /** Optional title for accessibility */
      title?: string;
    };
  }
```

This follows the same pattern as other UIResource variants with a discriminated union on `type`.
  </action>
  <verify>TypeScript compiles without errors: `cd packages/frontend && pnpm exec tsc --noEmit`</verify>
  <done>UIResource union type includes swipe_embed variant with embedUrl, fallbackUrl, and height params</done>
</task>

<task type="auto">
  <name>Task 2: Handle show_swipe_embed action in chat API</name>
  <files>packages/frontend/src/routes/api/chat.ts</files>
  <action>
Add a case for 'show_swipe_embed' action in the handleConversationMode switch statement (around line 1640, near the chart cases).

The handler should:
1. Build a swipe_embed UIResource with:
   - embedUrl: '/embed/swipe'
   - fallbackUrl: '/plan?tab=swipe'
   - height: 450
   - title: 'Swipe Strategies'
2. Return a response with appropriate French/English message
3. Set trace output attributes for observability

Example structure (follow the pattern of show_chart_gallery around line 1640):
```typescript
case 'show_swipe_embed': {
  response = `Voici les strat√©gies disponibles!\n\nSwipe pour choisir tes actions.`;
  const swipeResource: UIResource = {
    type: 'swipe_embed',
    params: {
      embedUrl: '/embed/swipe',
      fallbackUrl: '/plan?tab=swipe',
      height: 450,
      title: 'Swipe Strategies',
    },
  };
  const swipeTraceId = ctx.getTraceId();
  ctx.setOutput({ action: 'show_swipe_embed' });
  return {
    response,
    extractedData: {},
    nextStep: 'complete' as OnboardingStep,
    intent,
    traceId: swipeTraceId || undefined,
    traceUrl: swipeTraceId ? getTraceUrl(swipeTraceId) : undefined,
    source: 'groq' as const,
    uiResource: swipeResource,
  };
}
```
  </action>
  <verify>
1. TypeScript compiles: `cd packages/frontend && pnpm exec tsc --noEmit`
2. Start server and test: Send POST to /api/chat with message "swipe" and verify response contains uiResource with type swipe_embed
  </verify>
  <done>
- Chat API returns swipe_embed UIResource when show_swipe_embed action is detected
- UIResource contains embedUrl: '/embed/swipe', fallbackUrl: '/plan?tab=swipe', height: 450
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `cd packages/frontend && pnpm exec tsc --noEmit`
2. API test with curl:
```bash
curl -X POST http://localhost:3006/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"swipe","step":"conversation","mode":"conversation","context":{}}' \
  | jq '.uiResource'
```
Expected output contains:
```json
{
  "type": "swipe_embed",
  "params": {
    "embedUrl": "/embed/swipe",
    "fallbackUrl": "/plan?tab=swipe",
    "height": 450
  }
}
```
</verification>

<success_criteria>
- UIResource type includes swipe_embed variant (UIRS-01)
- embedUrl is '/embed/swipe' (UIRS-02)
- fallbackUrl is '/plan?tab=swipe' (UIRS-03)
- height defaults to 450 (UIRS-04)
- TypeScript compiles without errors
- API returns correct structure when swipe intent triggers
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-resource/02-01-SUMMARY.md`
</output>
