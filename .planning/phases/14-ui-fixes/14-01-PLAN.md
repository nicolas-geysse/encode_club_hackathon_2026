# Plan: 14-01 â€” UI Fixes (Button Placement and Dark Mode)

**Phase:** 14-ui-fixes
**Goal:** Move "Start my plan" button to chat area and fix dark mode visibility for Bruno avatar and progress indicator
**Requirements:** PLAC-01, PLAC-02, DARK-01, DARK-02

## Context

The "Start my plan" button is currently positioned in the Bruno sidebar (desktop) and bottom input area (mobile). Per requirements, it should appear as a message in the chat area after onboarding completion, not in these static locations.

Additionally, two dark mode visibility issues need fixing:
1. Bruno avatar uses `bg-gradient-to-br from-primary to-primary/60` with white text - in dark mode, primary becomes white, making the "B" invisible
2. Progress indicator pulse animation uses hardcoded blue RGB values that don't adapt to dark mode

## Tasks

### Task 1: Create completion message with "Start My Plan" button in chat area

**File:** `packages/frontend/src/components/chat/OnboardingChat.tsx`
**Action:** modify

**Changes:**
1. After the `For each={messages()}` block ends (around line 2651), add a `Show` block that renders the completion CTA when `isComplete()` and `step() === 'complete'`
2. The completion section should include a Bruno avatar, a completion message, and the GlassButton

Specific code addition after the `For each={messages()}` block:

```tsx
{/* Completion CTA - appears in chat area when onboarding complete */}
<Show when={isComplete() && step() === 'complete'}>
  <div class="flex justify-start mb-6 animate-in fade-in slide-in-from-bottom-4 duration-500 pl-2">
    <div class="flex items-start gap-3">
      <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 dark:from-emerald-400 dark:to-emerald-500 flex items-center justify-center text-white text-sm font-bold shadow-md ring-2 ring-background">
        B
      </div>
      <div class="flex flex-col gap-3">
        <div class="rounded-2xl px-5 py-3.5 shadow-sm text-sm leading-relaxed bg-white/80 dark:bg-slate-800/80 backdrop-blur-md border border-border/50 text-foreground rounded-tl-sm">
          <p class="whitespace-pre-wrap">Your profile is complete! Ready to start working towards your goal.</p>
        </div>
        <GlassButton onClick={goToPlan} class="w-fit">
          Start My Plan
          <svg
            class="animate-bounce-x ml-2"
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="3"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M5 12h14" />
            <path d="m12 5 7 7-7 7" />
          </svg>
        </GlassButton>
      </div>
    </div>
  </div>
</Show>
```

**Commit:** `fix(14-01): add Start My Plan button to chat area after completion`

### Task 2: Remove "Start My Plan" button from Bruno sidebar (desktop)

**File:** `packages/frontend/src/components/chat/OnboardingChat.tsx`
**Action:** modify

**Changes:**
1. Remove the "Start My Plan" section from the sidebar bottom (lines 2593-2617)
2. Keep the Restart button intact
3. The container `<div class="mt-auto p-6 w-full flex items-center justify-center gap-4">` should only contain the Restart button

Remove this entire block:
```tsx
{/* Start My Plan - Fades In Next to it */}
<div
  class={`transition-all duration-1000 transform overflow-hidden whitespace-nowrap ${
    isComplete() ? 'w-auto opacity-100 translate-x-0' : 'w-0 opacity-0 -translate-x-4'
  }`}
>
  <GlassButton onClick={goToPlan}>
    Start My Plan
    <svg ...>...</svg>
  </GlassButton>
</div>
```

**Commit:** `fix(14-01): remove Start My Plan button from Bruno sidebar`

### Task 3: Remove "Start My Plan" button from mobile bottom area

**File:** `packages/frontend/src/components/chat/OnboardingChat.tsx`
**Action:** modify

**Changes:**
1. Remove the mobile CTA section (lines 2726-2746) from inside the `<Show when={isComplete()}>` block at the bottom
2. Keep the `<ChatInput>` component intact

Remove this block:
```tsx
{/* Mobile CTA */}
<div class="md:hidden mt-3 animate-in slide-in-from-bottom-4 duration-500 w-full flex justify-center">
  <GlassButton onClick={goToPlan}>
    Start My Plan
    ...
  </GlassButton>
</div>
```

**Commit:** `fix(14-01): remove Start My Plan button from mobile input area`

### Task 4: Fix Bruno avatar visibility in dark mode

**File:** `packages/frontend/src/components/chat/OnboardingChat.tsx`
**Action:** modify

**Changes:**
1. Update the Bruno avatar gradient (line 2477) to use emerald colors that work in both light and dark mode
2. Update the orbital rings to use emerald colors instead of primary

Main avatar change from:
```tsx
<div class="relative z-10 w-24 h-24 rounded-full bg-gradient-to-br from-primary to-primary/60 flex items-center justify-center text-white text-3xl font-bold shadow-xl ring-4 ring-background">
```

Change to:
```tsx
<div class="relative z-10 w-24 h-24 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 dark:from-emerald-400 dark:to-emerald-500 flex items-center justify-center text-white text-3xl font-bold shadow-xl ring-4 ring-background">
```

Orbital rings changes:
- `border-primary/30` -> `border-emerald-500/30 dark:border-emerald-400/40`
- `border-primary/20` -> `border-emerald-500/20 dark:border-emerald-400/30`
- `border-primary/10` -> `border-emerald-500/10 dark:border-emerald-400/20`

**Commit:** `fix(14-01): improve Bruno avatar dark mode visibility with emerald gradient`

### Task 5: Fix progress indicator pulse animation in dark mode

**File:** `packages/frontend/src/components/chat/OnboardingProgress.css`
**Action:** modify

**Changes:**
1. Update the `subtle-pulse` keyframe animation to use emerald colors (rgb 16, 185, 129 = emerald-500)
2. Add a dark mode variant with brighter emerald (rgb 52, 211, 153 = emerald-400) for better visibility

Change from:
```css
@keyframes subtle-pulse {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
  }
  50% {
    transform: scale(1.1);
    box-shadow: 0 0 0 8px rgba(59, 130, 246, 0);
  }
}
```

Change to:
```css
@keyframes subtle-pulse {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
  }
  50% {
    transform: scale(1.1);
    box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
  }
}

/* Dark mode pulse with higher visibility */
@media (prefers-color-scheme: dark) {
  @keyframes subtle-pulse {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(52, 211, 153, 0.5);
    }
    50% {
      transform: scale(1.1);
      box-shadow: 0 0 0 8px rgba(52, 211, 153, 0);
    }
  }
}
```

**File:** `packages/frontend/src/components/chat/OnboardingProgress.tsx`
**Action:** modify

**Changes:**
Update the current step styling to use emerald colors instead of blue:

Change from:
```tsx
status() === 'current'
  ? 'w-3 h-3 bg-blue-500 ring-4 ring-blue-500/20'
```

Change to:
```tsx
status() === 'current'
  ? 'w-3 h-3 bg-emerald-500 dark:bg-emerald-400 ring-4 ring-emerald-500/20 dark:ring-emerald-400/30'
```

**Commit:** `fix(14-01): improve progress indicator pulse visibility in dark mode`

## must_haves

### truths
- "Start my plan button appears in chat completion message after For loop"
- "Start my plan button is NOT in Bruno sidebar (lines 2593-2617 removed)"
- "Start my plan button is NOT in mobile input area (lines 2726-2746 removed)"
- "Bruno avatar B circle has emerald gradient visible in both light and dark mode"
- "Progress indicator circles use emerald color visible in dark mode"
- "Progress indicator pulse animation uses emerald colors (not blue)"

### artifacts
- path: packages/frontend/src/components/chat/OnboardingChat.tsx
  provides: Main onboarding component with chat, Bruno sidebar, and completion flow
  contains: goToPlan function, isComplete signal, step signal, GlassButton import, Show component for completion CTA

- path: packages/frontend/src/components/chat/OnboardingProgress.tsx
  provides: Vertical progress indicator for onboarding steps
  contains: step status determination with emerald colors for current state

- path: packages/frontend/src/components/chat/OnboardingProgress.css
  provides: CSS animations for progress indicator
  contains: subtle-pulse keyframes with emerald colors, dark mode media query variant

### key_links
- from: packages/frontend/src/components/chat/OnboardingChat.tsx
  to: packages/frontend/src/components/ui/GlassButton.tsx
  via: import { GlassButton }
  pattern: Button used for "Start My Plan" CTA in chat area

- from: packages/frontend/src/components/chat/OnboardingProgress.tsx
  to: packages/frontend/src/components/chat/OnboardingProgress.css
  via: import './OnboardingProgress.css'
  pattern: CSS styles including pulse animations

## Verification

### PLAC-01: Start my plan in chat area
1. Complete onboarding flow (or set localStorage 'onboardingComplete' to 'true')
2. Verify "Start My Plan" button appears below the chat messages in the messages area
3. Click the button and verify navigation to /plan

### PLAC-02: Button removed from Bruno bar
1. Complete onboarding flow
2. Look at the left sidebar (Bruno bar) on desktop
3. Verify only the Restart button is visible, NOT "Start My Plan"

### DARK-01: Bruno avatar in dark mode
1. Toggle to dark mode using theme toggle (or system preference)
2. Look at Bruno avatar in the left sidebar
3. Verify the "B" letter is clearly visible against emerald gradient background
4. Verify orbital rings are visible with emerald coloring

### DARK-02: Progress indicator in dark mode
1. Toggle to dark mode
2. Start fresh onboarding (click Restart)
3. Progress through steps and observe the progress indicator
4. Verify current step circle has visible emerald color and pulse animation
5. Verify step circles have good contrast in dark mode

---

**Plan created:** 2026-01-31
**Requirements covered:** PLAC-01, PLAC-02, DARK-01, DARK-02
