---
phase: 16-privacy-consent
plan: 03
type: execute
wave: 3
depends_on: ["16-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Consent screen appears before location permission dialog"
    - "Manual city entry works without GPS"
    - "Database shows fuzzy coordinates only"
    - "Opik traces contain no raw GPS values"
  artifacts: []
  key_links: []
---

<objective>
Verify privacy consent implementation end-to-end.

Purpose: Human verification that the privacy-first location handling works correctly across all user paths - both GPS allow and manual city entry flows.

Output: Verified implementation with any issues fixed.
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/16-privacy-consent/16-01-SUMMARY.md
@.planning/phases/16-privacy-consent/16-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify consent flow and privacy compliance</name>
  <what-built>
Privacy-first location consent flow with:
1. Consent screen shown before any GPS access
2. Two options: "Allow location access" or "Enter my city instead"
3. Fuzzy coordinates stored in DuckDB (2 decimal places)
4. Opik trace sanitization for location PII
  </what-built>
  <how-to-verify>
**Setup:**
1. Start the dev server: `pnpm dev`
2. Open browser to http://localhost:3006
3. Clear localStorage/cookies to simulate new user
4. Have DevTools Network tab open

**Test Flow A - Allow GPS:**
1. On page load, consent screen should appear BEFORE Bruno's greeting
2. Text should say "We use your location to show you part-time jobs near you..."
3. Click "Allow location access"
4. Browser should show location permission prompt
5. After allowing, Bruno's greeting should appear
6. Check that city is auto-filled from GPS

**Test Flow B - Manual Entry:**
1. Clear storage, refresh
2. On consent screen, click "Enter my city instead"
3. Bruno's greeting should appear asking for city
4. Enter "Paris" and continue
5. Verify onboarding proceeds normally

**Verify Database:**
1. After completing onboarding, check DuckDB:
   ```bash
   echo "SELECT id, city, latitude, longitude FROM profiles ORDER BY created_at DESC LIMIT 1;" | duckdb data/stride.duckdb
   ```
2. Latitude/longitude should have exactly 2 decimal places (e.g., 48.86, 2.35)

**Verify Opik Traces:**
1. Check recent traces in Opik dashboard
2. Search for any occurrence of raw coordinates (5+ decimal places)
3. Location fields should show "[LOCATION_REDACTED]"

**Expected Results:**
- [ ] Consent screen appears before Bruno's greeting
- [ ] Both "Allow" and "Enter city" buttons work
- [ ] GPS path fills city automatically
- [ ] Manual path allows city entry in chat
- [ ] DuckDB has fuzzy coordinates only
- [ ] Opik traces have no raw GPS values
  </how-to-verify>
  <resume-signal>
Type "approved" if all checks pass, or describe specific issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Human-verified end-to-end flow for both GPS and manual paths.
</verification>

<success_criteria>
- User explicitly approves both consent flows work correctly
- Database inspection confirms fuzzy coordinates
- Opik traces confirmed clean of raw GPS data
</success_criteria>

<output>
After completion, create `.planning/phases/16-privacy-consent/16-03-SUMMARY.md`
</output>
