---
phase: 23-ux-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/src/components/EarningsChart.tsx
autonomous: true

must_haves:
  truths:
    - "User can see clear labels explaining what each stat means"
    - "User can hover over stats to see detailed tooltips with explanations"
    - "Chart has a visible legend explaining all line types"
    - "Status colors match the same scheme used in WeeklyProgressCards"
  artifacts:
    - path: "packages/frontend/src/components/EarningsChart.tsx"
      provides: "Improved labels, tooltips, and legend"
      contains: "This Week's Target"
  key_links:
    - from: "packages/frontend/src/components/EarningsChart.tsx"
      to: "GOAL_STATUS_THRESHOLDS"
      via: "Consistent status thresholds import"
      pattern: "import.*GOAL_STATUS_THRESHOLDS"
---

<objective>
Improve EarningsChart label clarity and add proper tooltips and legend so users understand what each value and line represents.

Purpose: Users are confused by generic labels like "Saved" and "Weekly Need" and don't understand the difference between the chart lines. Clear labels and a legend will build user trust.

Output: EarningsChart with clarified labels, hover tooltips explaining each stat, and a visible legend explaining all chart lines.
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/bugs-dev/goals-fix.md (Section 4.5 - Ameliorer la Clarte des Intitules)

# Key file to modify
@packages/frontend/src/components/EarningsChart.tsx

# For consistent status colors
@packages/frontend/src/components/WeeklyProgressCards.tsx (lines 277-311 - statusConfig)
@packages/frontend/src/lib/goalStatus.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update stat labels and add title tooltips</name>
  <files>packages/frontend/src/components/EarningsChart.tsx</files>
  <action>
Update the stats panel (lines 401-466) with clearer labels and native title tooltips:

1. Change "Saved" label (line 404) to "Total Earned":
   - The current label "Saved" is misleading since it includes missions, trades, etc.
   - Update: `<p class="text-[10px] text-muted-foreground uppercase">Total Earned</p>`
   - Add title attribute to parent div: `title="Sum of all your income sources toward this goal (missions, savings, sales)"`

2. Change "Weekly Need" label (line 417) to "This Week's Target":
   - Update: `<p class="text-[10px] text-muted-foreground uppercase">This Week's Target</p>`
   - Add title attribute: `title="Amount adjusted based on your availability this week (capacity-aware calculation)"`

3. Update the "Status" section (line 441) to show threshold info:
   - Keep the label as "Status"
   - Add title attribute explaining thresholds: `title="Based on cumulative progress: Ahead (105%+), On Track (90%+), Behind (40%+), Critical (<40%)"`

4. Update the weeks remaining line (around line 461-463) from "~{X}w remaining" to "Est. {X} weeks":
   - Update template: ``{stats().weeksToGoal ? `Est. ${stats().weeksToGoal} weeks` : ''}``
   - Add title: `title="Estimate based on your current earning rate"`

Use native HTML title attributes for tooltips - they're simple and work everywhere without additional dependencies.
  </action>
  <verify>
1. Run `pnpm dev` and navigate to /plan > Goals tab
2. Verify labels show "Total Earned", "This Week's Target", "Status"
3. Hover over each stat panel - verify title tooltips appear after ~1 second
4. Verify weeks remaining shows "Est. X weeks" format
  </verify>
  <done>
Labels are updated to be clearer: "Saved" -> "Total Earned", "Weekly Need" -> "This Week's Target". All stats have title tooltips explaining their meaning.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add explicit chart legend below the chart</name>
  <files>packages/frontend/src/components/EarningsChart.tsx</files>
  <action>
Add a visible legend below the chart explaining all lines (when not in compact mode):

1. Locate the chart canvas container div (around lines 469-471). This div contains `<canvas ref={setChartCanvas} />`.

2. **Insert location:** Insert the legend JSX immediately AFTER the closing `</div>` tag of the chart canvas container div (line 471), as a sibling element within the parent `<div class="space-y-3">` container. The legend should be at the same nesting level as the chart canvas div.

3. Insert this legend JSX:

```tsx
{/* Chart Legend */}
<Show when={!props.compact}>
  <div class="flex flex-wrap gap-x-4 gap-y-1 text-[10px] text-muted-foreground mt-2 pt-2 border-t border-border/50">
    <span class="flex items-center gap-1">
      <span class="inline-block w-4 h-0.5 bg-red-500" style={{ "border-style": "dashed" }} />
      Goal target ({formatCurrency(props.goal.amount, currency())})
    </span>
    <span class="flex items-center gap-1">
      <span class="inline-block w-4 h-0.5 bg-yellow-500" />
      Required pace
    </span>
    <span class="flex items-center gap-1">
      <span class="inline-block w-4 h-0.5 bg-green-500" />
      Projected
    </span>
    <Show when={props.weeklyEarnings && props.weeklyEarnings.length > 0}>
      <span class="flex items-center gap-1">
        <span class="inline-block w-4 h-0.5 bg-blue-500" />
        Actual
      </span>
    </Show>
  </div>
</Show>
```

4. The colors must match the chart datasets (lines 213-260):
   - Goal: red (rgb(239, 68, 68)) with dashed border
   - Required Pace: yellow/amber (rgb(234, 179, 8))
   - Projected: green (rgb(34, 197, 94))
   - Actual: blue (rgb(59, 130, 246))

5. Make the legend responsive:
   - Use flex-wrap so it wraps on narrow screens
   - Keep text small (text-[10px]) to not overwhelm the chart
   - Add subtle top border to separate from chart

Note: Chart.js has its own legend (line 271-278, display: !props.compact) but it uses small boxes. This additional legend below uses line samples which better represent the actual chart visualization.
  </action>
  <verify>
1. Navigate to /plan > Goals tab (non-compact view)
2. Verify legend appears below the chart with colored line samples
3. Verify colors match the actual chart lines
4. Verify "Actual" legend item only shows when there's actual earnings data
5. Resize to mobile width - legend should wrap properly
  </verify>
  <done>
Chart has a visible legend below it explaining all lines with matching colors. Legend wraps properly on mobile and only shows "Actual" when actual earnings data exists.
  </done>
</task>

<task type="auto">
  <name>Task 3: Ensure consistent status colors with WeeklyProgressCards</name>
  <files>packages/frontend/src/components/EarningsChart.tsx</files>
  <action>
Import GOAL_STATUS_THRESHOLDS and align status colors between EarningsChart and WeeklyProgressCards:

1. **Add import at top of file** (near other imports from ~/lib):
```tsx
import { GOAL_STATUS_THRESHOLDS } from '~/lib/goalStatus';
```

2. Check current status colors in EarningsChart (lines 443-460):
   - ahead: green
   - on-track: green (should match primary like WeeklyProgressCards)
   - behind: amber
   - critical: red

3. Compare with WeeklyProgressCards statusConfig (lines 277-311):
   - ahead: green-500/green-600 (text-green-600 dark:text-green-400)
   - on-track: primary (text-primary)
   - behind: amber-500/amber-600 (text-amber-600 dark:text-amber-400)
   - critical: red-500/red-600 (text-red-600 dark:text-red-400)

4. Update EarningsChart status display (around line 443-459) to handle BOTH cases:
   - When `props.stats?.status` is provided (new explicit status)
   - When `props.stats` is not provided and falling back to `stats().onPace` (backward compatibility)

   Use this updated conditional:
```tsx
<p
  class={`text-sm font-bold ${
    props.stats?.status === 'ahead'
      ? 'text-green-600 dark:text-green-400'
      : props.stats?.status === 'on-track'
        ? 'text-primary'
        : props.stats?.status === 'behind'
          ? 'text-amber-600 dark:text-amber-400'
          : props.stats?.status === 'critical'
            ? 'text-red-600 dark:text-red-400'
            : stats().onPace
              ? 'text-primary'  // Fallback: onPace=true uses primary (matches on-track)
              : 'text-red-600 dark:text-red-400'  // Fallback: onPace=false uses red (matches critical)
  }`}
>
```

5. The key changes:
   - `on-track` status uses `text-primary` instead of green (matches WeeklyProgressCards)
   - `stats().onPace` fallback also uses `text-primary` for consistency when on pace
   - Explicit handling of all 4 status values before falling back to onPace

6. Update the Status tooltip to use GOAL_STATUS_THRESHOLDS:
   - Change the title attribute to dynamically show threshold values:
```tsx
title={`Based on cumulative progress: Ahead (${GOAL_STATUS_THRESHOLDS.AHEAD}%+), On Track (${GOAL_STATUS_THRESHOLDS.ON_TRACK}%+), Behind (${GOAL_STATUS_THRESHOLDS.BEHIND}%+), Critical (<${GOAL_STATUS_THRESHOLDS.BEHIND}%)`}
```

7. Verify the status text and emoji combinations match:
   - ahead: Ahead emoji
   - on-track: On Track checkmark
   - behind: Behind warning
   - critical: Critical red circle
  </action>
  <verify>
1. Run `grep -n "import.*GOAL_STATUS_THRESHOLDS" packages/frontend/src/components/EarningsChart.tsx` - should find the import
2. Navigate to /plan > Goals tab
3. Compare status colors between the EarningsChart panel and WeeklyProgressCards
4. Confirm `status=on-track` renders with `text-primary` color
5. Confirm `stats().onPace` fallback (when props.stats not provided) ALSO renders with `text-primary` color
6. Check in dark mode - colors should be consistent across both components
7. Hover over Status - tooltip should show threshold percentages from GOAL_STATUS_THRESHOLDS
  </verify>
  <done>
GOAL_STATUS_THRESHOLDS is imported from goalStatus.ts. Status colors are consistent between EarningsChart and WeeklyProgressCards. Both `status=on-track` and `stats().onPace` fallback use `text-primary`. Status tooltip displays threshold values from the imported constant.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. Run `pnpm typecheck` - should pass with no errors
2. Run `pnpm lint` - should pass (or only pre-existing warnings)
3. Run `grep -n "import.*GOAL_STATUS_THRESHOLDS" packages/frontend/src/components/EarningsChart.tsx` - must find the import
4. Visual comparison: EarningsChart labels are clearer and have tooltips
5. Visual comparison: Chart legend is visible and colors match chart lines
6. Visual comparison: Status colors match between EarningsChart and WeeklyProgressCards
7. Mobile check: Legend wraps properly at narrow widths
</verification>

<success_criteria>
- [ ] "Saved" renamed to "Total Earned" with tooltip explaining all income sources
- [ ] "Weekly Need" renamed to "This Week's Target" with tooltip explaining capacity-aware calculation
- [ ] Status has tooltip showing threshold percentages from GOAL_STATUS_THRESHOLDS
- [ ] GOAL_STATUS_THRESHOLDS is imported from ~/lib/goalStatus
- [ ] Chart has visible legend showing Goal, Required pace, Projected, and Actual lines
- [ ] Legend colors match actual chart line colors
- [ ] Status colors are consistent with WeeklyProgressCards (on-track uses text-primary)
- [ ] stats().onPace fallback also renders with text-primary for consistency
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-ux-polish/23-02-SUMMARY.md`
</output>
