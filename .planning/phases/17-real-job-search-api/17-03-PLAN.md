---
phase: 17-real-job-search-api
plan: 03
type: execute
wave: 3
depends_on: ["17-02"]
files_modified:
  - packages/frontend/src/components/tabs/ProspectionTab.tsx
  - packages/frontend/src/components/prospection/ProspectionSwipeDeck.tsx
autonomous: false

must_haves:
  truths:
    - "Job cards display star ratings based on scoring algorithm"
    - "Top Pick badge appears on jobs with score >= 4.5"
    - "Job cards show real business names, addresses, and Google ratings"
  artifacts:
    - path: "packages/frontend/src/components/tabs/ProspectionTab.tsx"
      provides: "Integrated scoring in prospection flow"
      contains: "scoreJobsForProfile"
    - path: "packages/frontend/src/components/prospection/ProspectionSwipeDeck.tsx"
      provides: "Star rating display on cards"
      contains: "StarRating"
  key_links:
    - from: "ProspectionTab.tsx"
      to: "jobScoring.ts"
      via: "import"
      pattern: "import.*scoreJobsForProfile.*from.*jobScoring"
    - from: "ProspectionSwipeDeck.tsx"
      to: "star rating display"
      via: "conditional rendering"
      pattern: "score.*Star"
---

<objective>
Update ProspectionTab and SwipeDeck UI to display star ratings and integrate job scoring.

Purpose: JOBS-02 (display name/address/rating), JOBS-05 (star rating based on scoring)
Output: Job cards with star ratings and Top Pick badges
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-real-job-search-api/17-02-SUMMARY.md

@packages/frontend/src/components/tabs/ProspectionTab.tsx
@packages/frontend/src/components/prospection/ProspectionSwipeDeck.tsx
@packages/frontend/src/lib/jobScoring.ts
@packages/frontend/src/lib/prospectionTypes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scoring to ProspectionTab flow</name>
  <files>packages/frontend/src/components/tabs/ProspectionTab.tsx</files>
  <action>
Integrate job scoring into the prospection search flow.

1. Add import at top of file:
   ```typescript
   import { scoreJobsForProfile, type ScoredJob, type UserProfile } from '~/lib/jobScoring';
   ```

2. Add props interface extension or use existing props to get user profile data:
   ```typescript
   // In ProspectionTabProps (may need to update in prospectionTypes.ts if not there)
   export interface ProspectionTabProps {
     // ... existing props
     userSkills?: string[];
     minHourlyRate?: number;
   }
   ```

3. Update the handleCategorySelect function (around line 67-99) to score results:
   ```typescript
   const handleCategorySelect = async (categoryId: string) => {
     setLoadingCategory(categoryId);
     setPhase('loading');

     try {
       const response = await fetch('/api/prospection', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({
           action: 'search',
           categoryId,
           latitude: props.userLocation?.lat,
           longitude: props.userLocation?.lng,
           city: props.city,
         }),
       });

       if (!response.ok) {
         throw new Error('Search failed');
       }

       const data = await response.json();

       // Build user profile for scoring
       const userProfile: UserProfile = {
         skills: props.userSkills,
         minHourlyRate: props.minHourlyRate,
       };

       // Score and sort jobs
       const scoredCards = scoreJobsForProfile(data.cards, userProfile);

       setCurrentCards(scoredCards);
       setCurrentCategory(categoryId);
       setSwipeResults([]);
       setPhase('swiping');
     } catch (err) {
       // ... existing error handling
     }
   };
   ```

4. Update the signal type to use ScoredJob:
   ```typescript
   // Change from:
   const [currentCards, setCurrentCards] = createSignal<ProspectionCard[]>([]);
   // To:
   const [currentCards, setCurrentCards] = createSignal<ScoredJob[]>([]);
   ```

5. Update import for ScoredJob type and ensure ProspectionCard is still imported:
   ```typescript
   import type {
     ProspectionCard,
     Lead,
     LeadStatus,
     SwipeResult,
     ProspectionTabProps,
   } from '~/lib/prospectionTypes';
   ```
  </action>
  <verify>
`pnpm typecheck` passes with the new ScoredJob type usage.
  </verify>
  <done>
ProspectionTab scores jobs using the scoring algorithm and passes scored cards to SwipeDeck.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add star rating display to SwipeDeck cards</name>
  <files>packages/frontend/src/components/prospection/ProspectionSwipeDeck.tsx</files>
  <action>
Add star rating display and Top Pick badge to the swipe cards.

1. First, read the current file to understand the card rendering structure.

2. Add imports:
   ```typescript
   import { Star, Award } from 'lucide-solid';
   import { formatStarRating, isTopPick, type ScoredJob } from '~/lib/jobScoring';
   ```

3. Update the props interface to accept ScoredJob instead of ProspectionCard:
   ```typescript
   interface ProspectionSwipeDeckProps {
     cards: ScoredJob[];
     onSwipe: (result: SwipeResult) => void;
     onComplete: (saved: ScoredJob[], skipped: ScoredJob[]) => void;
   }
   ```

4. Add StarRating component (inside the file or as a local component):
   ```typescript
   function StarRating(props: { score: number; size?: 'sm' | 'md' }) {
     const size = props.size === 'sm' ? 'h-3 w-3' : 'h-4 w-4';
     const fullStars = Math.floor(props.score);
     const hasHalfStar = props.score - fullStars >= 0.5;

     return (
       <div class="flex items-center gap-0.5">
         {Array.from({ length: 5 }, (_, i) => (
           <Star
             class={`${size} ${
               i < fullStars
                 ? 'fill-yellow-400 text-yellow-400'
                 : i === fullStars && hasHalfStar
                 ? 'fill-yellow-400/50 text-yellow-400'
                 : 'text-gray-300'
             }`}
           />
         ))}
         <span class="ml-1 text-sm font-medium text-foreground">
           {formatStarRating(props.score)}
         </span>
       </div>
     );
   }
   ```

5. Add TopPickBadge component:
   ```typescript
   function TopPickBadge() {
     return (
       <div class="absolute top-2 right-2 flex items-center gap-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg">
         <Award class="h-3 w-3" />
         Top Pick
       </div>
     );
   }
   ```

6. Update the card rendering to include star rating and Top Pick badge.
   Find the card component/template and add:
   ```tsx
   {/* Top Pick badge - positioned absolutely */}
   <Show when={isTopPick(card.score)}>
     <TopPickBadge />
   </Show>

   {/* Star rating - add near the salary/rate display */}
   <div class="flex items-center justify-between mt-2">
     <StarRating score={card.score} />
     <span class="text-sm text-muted-foreground">{card.salaryText}</span>
   </div>
   ```

7. Also display Google rating if available (different from our calculated score):
   ```tsx
   <Show when={card.rating}>
     <div class="flex items-center gap-1 text-xs text-muted-foreground">
       <Star class="h-3 w-3 fill-yellow-400 text-yellow-400" />
       <span>{card.rating?.toFixed(1)} Google</span>
     </div>
   </Show>
   ```
  </action>
  <verify>
1. `pnpm typecheck` passes
2. `pnpm dev` - visually verify star ratings appear on cards
  </verify>
  <done>
SwipeDeck cards display calculated star ratings (1-5) and Top Pick badges for high-scoring jobs.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify real job search end-to-end</name>
  <what-built>
Real Google Places API integration with job scoring and star rating display:
1. Prospection API returns real Google Places results
2. Jobs are scored based on distance, profile match, effort, and rate
3. Star ratings display on swipe cards
4. Top Pick badge appears on high-scoring jobs (>= 4.5)
  </what-built>
  <how-to-verify>
1. Start dev server: `pnpm dev`
2. Go to http://localhost:3006
3. Complete onboarding with location consent (use real location or Paris: 48.8566, 2.3522)
4. Navigate to Plan page, open Prospection tab
5. Click on "Service & Hospitality" category
6. Verify:
   - Cards show real business names (not "Le Petit Bistrot" mock)
   - Cards have real addresses
   - Cards display star ratings (1-5 scale)
   - At least some cards may show "Top Pick" badge if scored >= 4.5
   - Google rating appears separately from calculated score
7. Try another category (e.g., "Retail & Sales") - verify real store names
8. Try a category without Google Place types (e.g., "Events & Promo") - should show platform suggestions
  </how-to-verify>
  <resume-signal>Type "approved" if real jobs appear with ratings, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. Visual verification of star ratings on job cards
3. Real Google Places data appears (not mock data)
4. Top Pick badge appears on high-scoring jobs
</verification>

<success_criteria>
- Job cards display calculated star ratings (1-5 scale)
- Top Pick badge appears on jobs with score >= 4.5
- Real business names and addresses from Google Places
- Google rating displayed separately from calculated score
- All 5 requirements (JOBS-01 through JOBS-05) verified working
</success_criteria>

<output>
After completion, create `.planning/phases/17-real-job-search-api/17-03-SUMMARY.md`
</output>
