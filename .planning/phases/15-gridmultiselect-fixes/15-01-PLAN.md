# Plan: 15-01 â€” GridMultiSelect Fixes

**Phase:** 15-gridmultiselect-fixes
**Goal:** Fix skills list empty state, column width truncation, and make certifications grid wider
**Requirements:** GRID-01, GRID-02, GRID-03

## Context

The GridMultiSelect component used for skills and certifications in onboarding has three issues:

1. **Empty state bug (GRID-01)**: The skills list sometimes shows empty. The options are computed in `OnboardingFormStep.tsx` inside a switch case as a non-reactive const. While the fallback logic in `getSkillsForField()` correctly returns all skills when field is undefined, we need to ensure the options are computed reactively and the GridMultiSelect receives valid data.

2. **Truncated names (GRID-02)**: The grid uses `grid-cols-2 sm:grid-cols-3` and buttons have `truncate` class, causing long skill names like "Urban gardening / permaculture consulting" to be cut off.

3. **Narrow certifications grid (GRID-03)**: The form container uses `max-w-md` (28rem/448px) while chat messages use `max-w-3xl` (48rem/768px). Certifications should be wider to match the chat response area.

## Tasks

### Task 1: Add variant prop to GridMultiSelect and fix text truncation

**File:** `packages/frontend/src/components/chat/GridMultiSelect.tsx`
**Action:** modify

**Changes:**
1. Add `variant?: 'default' | 'wide'` prop to `GridMultiSelectProps` interface
2. Change grid columns based on variant:
   - default: `grid-cols-1 sm:grid-cols-2` (fewer columns to prevent truncation)
   - wide: `grid-cols-2 sm:grid-cols-3 md:grid-cols-4` (more columns for wider container)
3. Remove `truncate` class from button and use `whitespace-normal` for multi-line text
4. Add empty state message when no options available

Updated props interface:
```tsx
interface GridMultiSelectProps {
  /** Available options to display */
  options: string[];
  /** Currently selected items */
  selected: string[];
  /** Callback when selection changes */
  onChange: (selected: string[]) => void;
  /** Placeholder text for filter input */
  placeholder?: string;
  /** Maximum height for scrollable container (default: 200px) */
  maxHeight?: string;
  /** Display variant - 'wide' uses more columns for wider containers */
  variant?: 'default' | 'wide';
}
```

Update grid classes:
```tsx
<div class={`grid gap-2 ${
  (props.variant || 'default') === 'wide'
    ? 'grid-cols-2 sm:grid-cols-3 md:grid-cols-4'
    : 'grid-cols-1 sm:grid-cols-2'
}`}>
```

Update button classes (remove truncate, use whitespace-normal):
```tsx
class={`px-3 py-1.5 rounded-lg text-sm cursor-pointer transition-colors whitespace-normal text-left ${
  isSelected(option)
    ? 'bg-primary border border-primary text-primary-foreground'
    : 'bg-muted border border-border text-foreground hover:bg-muted/80'
}`}
```

Add empty state after For loop:
```tsx
<Show when={filteredOptions().length === 0}>
  <p class="text-sm text-muted-foreground py-4 text-center col-span-full">
    {filter() ? 'No matches found. Try a different search.' : 'No options available.'}
  </p>
</Show>
```

**Commit:** `fix(15-01): add variant prop to GridMultiSelect and fix text truncation`

### Task 2: Make skills options reactive and pass variant for certifications

**File:** `packages/frontend/src/components/chat/OnboardingFormStep.tsx`
**Action:** modify

**Changes:**
1. In the `case 'multi-select-pills'` block, convert `options` const to a getter function to ensure reactivity
2. Pass `variant="wide"` for certifications grid

Update the multi-select-pills case:
```tsx
case 'multi-select-pills': {
  // For skills and certifications, use the new GridMultiSelect component
  const isSkillsField = props.step === 'skills' && field.name === 'skills';
  const isCertificationsField =
    props.step === 'certifications' && field.name === 'certifications';

  // Use GridMultiSelect for skills and certifications steps
  if (isSkillsField || isCertificationsField) {
    // Make options reactive by using a getter
    const getOptions = () => isSkillsField
      ? getSkillsForField(props.fieldOfStudy)
      : POPULAR_CERTIFICATIONS.map((c) => c.label);

    return (
      <GridMultiSelect
        options={getOptions()}
        selected={(value() as string[]) || []}
        onChange={(v) => updateField(field.name, v)}
        placeholder={field.placeholder}
        variant={isCertificationsField ? 'wide' : 'default'}
      />
    );
  }

  // Fallback to MultiSelectPills for other multi-select-pills uses
  return (
    <MultiSelectPills
      field={field}
      selected={(value() as string[]) || []}
      onChange={(v) => updateField(field.name, v)}
      getSuggestions={undefined}
    />
  );
}
```

**Commit:** `fix(15-01): make skills options reactive and add wide variant for certifications`

### Task 3: Widen certifications form container in OnboardingChat

**File:** `packages/frontend/src/components/chat/OnboardingChat.tsx`
**Action:** modify

**Changes:**
1. Update the form container div to use a wider max-width for certifications step
2. Add conditional class based on current step

Find the form container (around line 2689):
```tsx
<div class="ml-12 mb-4 max-w-md">
```

Change to:
```tsx
<div class={`ml-12 mb-4 ${step() === 'certifications' ? 'max-w-2xl' : 'max-w-md'}`}>
```

This makes certifications container 42rem (672px) vs skills 28rem (448px) - approximately 1.5x wider, which combined with more grid columns achieves the 2x display area goal.

**Commit:** `fix(15-01): widen certifications form container to max-w-2xl`

## must_haves

### truths
- "Skills list shows options when skills data exists (getSkillsForField returns all skills when field undefined)"
- "Skill names display fully without truncation (whitespace-normal instead of truncate)"
- "Skills grid uses grid-cols-1 sm:grid-cols-2 for better readability"
- "Certifications grid is wider using max-w-2xl container and variant='wide'"
- "Certifications grid uses grid-cols-2 sm:grid-cols-3 md:grid-cols-4"
- "Empty state shows helpful message instead of blank area"

### artifacts
- path: packages/frontend/src/components/chat/GridMultiSelect.tsx
  provides: Grid-based multi-select component with variant support
  contains: GridMultiSelectProps interface with variant prop, grid column classes based on variant, whitespace-normal for full text display, empty state Show block

- path: packages/frontend/src/components/chat/OnboardingFormStep.tsx
  provides: Form step renderer that uses GridMultiSelect for skills and certifications
  contains: getOptions getter function for reactive options, variant prop passed to GridMultiSelect

- path: packages/frontend/src/components/chat/OnboardingChat.tsx
  provides: Main onboarding chat component
  contains: Conditional max-w class for form container based on step (max-w-2xl for certifications)

### key_links
- from: packages/frontend/src/components/chat/OnboardingFormStep.tsx
  to: packages/frontend/src/components/chat/GridMultiSelect.tsx
  via: import GridMultiSelect from './GridMultiSelect'
  pattern: Component renders GridMultiSelect with options and variant props

- from: packages/frontend/src/components/chat/OnboardingFormStep.tsx
  to: packages/frontend/src/lib/chat/stepForms.ts
  via: import { getSkillsForField, POPULAR_CERTIFICATIONS }
  pattern: Gets skill suggestions based on field of study

## Verification

### GRID-01: Skills list always shows options
1. Start fresh onboarding (clear localStorage, click Restart)
2. Progress to the Skills step
3. Verify the skills grid shows options immediately (never empty)
4. If fieldOfStudy is set from previous step, verify relevant skills appear
5. If fieldOfStudy is undefined, verify all skills appear as fallback

### GRID-02: Skill names display fully
1. On the Skills step, look for long skill names like "Urban gardening / permaculture consulting"
2. Verify the full name is visible (may wrap to 2 lines) without truncation/ellipsis
3. Hover over skills and verify the title tooltip matches the visible text

### GRID-03: Certifications grid is wider
1. Progress to the Certifications step
2. Compare the grid width to the Skills step - certifications should be noticeably wider
3. Verify certifications grid uses 4 columns on desktop (md breakpoint)
4. Verify certification names display fully without truncation

### Edge cases
1. Type in filter input to search - verify filtered results display correctly
2. Clear filter - verify all options return
3. Filter with no matches - verify "No matches found" message appears

---

**Plan created:** 2026-01-31
**Requirements covered:** GRID-01, GRID-02, GRID-03
