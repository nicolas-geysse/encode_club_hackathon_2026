---
phase: 01-intent-detection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/src/lib/chat/intent/detector.ts
  - packages/frontend/src/lib/chat/intent/llmClassifier.ts
autonomous: true

must_haves:
  truths:
    - "User typing 'swipe' in chat triggers swipe intent detection"
    - "User typing 'actions' triggers swipe intent detection"
    - "User typing 'strategies' or 'strategies' triggers swipe intent detection"
    - "French phrases 'que puis-je faire?' and 'quelles options' trigger swipe intent"
    - "Intent detection works via regex fast-path (~1ms)"
    - "Intent detection falls back to LLM when regex fails"
  artifacts:
    - path: "packages/frontend/src/lib/chat/intent/detector.ts"
      provides: "Swipe intent regex patterns"
      contains: "SWIPE_PATTERNS"
    - path: "packages/frontend/src/lib/chat/intent/llmClassifier.ts"
      provides: "Swipe action in LLM classifier"
      contains: "show_swipe_embed"
  key_links:
    - from: "packages/frontend/src/lib/chat/intent/detector.ts"
      to: "SWIPE_PATTERNS"
      via: "Pattern matching before LLM fallback"
      pattern: "SWIPE_PATTERNS.*test\\(lower\\)"
    - from: "packages/frontend/src/lib/chat/intent/llmClassifier.ts"
      to: "SUPPORTED_ACTIONS"
      via: "LLM action enum includes swipe"
      pattern: "show_swipe_embed"
---

<objective>
Add swipe intent detection to the chat system so users can trigger the Swipe component by saying "swipe", "actions", "strategies", "que puis-je faire?", or "quelles options".

Purpose: Phase 1 of Swipe-in-Chat - users need a way to trigger the swipe experience from chat before we can display it.
Output: Regex patterns for fast-path detection + LLM fallback classification for swipe intent.
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

# Source files to modify
@packages/frontend/src/lib/chat/intent/detector.ts
@packages/frontend/src/lib/chat/intent/llmClassifier.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add swipe intent patterns to regex detector</name>
  <files>packages/frontend/src/lib/chat/intent/detector.ts</files>
  <action>
    Add SWIPE_PATTERNS array following the existing CHART_GALLERY_PATTERNS pattern:

    ```typescript
    // =============================================================================
    // SWIPE-RELATED PATTERNS (Swipe-in-Chat)
    // =============================================================================

    /**
     * Patterns for requesting swipe strategies
     * Matches: "swipe", "actions", "strategies", "que puis-je faire", "quelles options"
     */
    const SWIPE_PATTERNS = [
      // SIMPLE: Single word triggers
      /^(?:swipe|actions?|stratégie?s?)[\s?!.]*$/i,
      // FR: "que puis-je faire", "quelles options", "quelles actions"
      /\b(?:que\s+puis[- ]?je\s+faire|quelles?\s+(?:options?|actions?|stratégies?))\b/i,
      // FR: "qu'est-ce que je peux faire", "que faire"
      /\b(?:qu['']?est[- ]?ce\s+que\s+je\s+(?:peux|pourrais?)\s+faire|que\s+faire)\b/i,
      // EN: "what can I do", "what options", "what actions"
      /\b(?:what\s+(?:can\s+i\s+do|options?|actions?|strategies?))\b/i,
      // Direct requests: "show swipe", "open swipe", "montre les swipes"
      /\b(?:show|open|montre[rz]?|affiche[rz]?|ouvre?)\s+(?:le\s+|les?\s+)?(?:swipe|options?|stratégies?)\b/i,
    ];
    ```

    Then add swipe detection BEFORE the chart patterns section (after SUIVI-SPECIFIC INTENTS, around line 596):

    ```typescript
    // ==========================================================================
    // SWIPE INTENT (Swipe-in-Chat)
    // ==========================================================================
    for (const pattern of SWIPE_PATTERNS) {
      if (pattern.test(lower)) {
        return {
          mode: 'conversation',
          action: 'show_swipe_embed',
          _matchedPattern: 'swipe_intent',
        };
      }
    }
    ```

    Place this detection BEFORE the chart detection block to ensure swipe-specific keywords are matched first.
  </action>
  <verify>
    Manual regex test:
    - /^(?:swipe|actions?|stratégie?s?)[\s?!.]*$/i.test("swipe") === true
    - /^(?:swipe|actions?|stratégie?s?)[\s?!.]*$/i.test("actions") === true
    - /^(?:swipe|actions?|stratégie?s?)[\s?!.]*$/i.test("strategies") === true
    - /\b(?:que\s+puis[- ]?je\s+faire|quelles?\s+(?:options?|actions?|stratégies?))\b/i.test("que puis-je faire?") === true
    - /\b(?:que\s+puis[- ]?je\s+faire|quelles?\s+(?:options?|actions?|stratégies?))\b/i.test("quelles options") === true

    TypeScript compilation:
    ```bash
    cd packages/frontend && pnpm typecheck
    ```
  </verify>
  <done>
    Regex patterns detect all 5 required triggers: "swipe", "actions", "strategies", "que puis-je faire?", "quelles options"
  </done>
</task>

<task type="auto">
  <name>Task 2: Add swipe action to LLM classifier</name>
  <files>packages/frontend/src/lib/chat/intent/llmClassifier.ts</files>
  <action>
    1. Add 'show_swipe_embed' to SUPPORTED_ACTIONS array (after 'show_energy_chart'):

    ```typescript
    export const SUPPORTED_ACTIONS = [
      'show_chart_gallery',
      'show_budget_chart',
      'show_progress_chart',
      'show_projection_chart',
      'show_energy_chart',
      'show_swipe_embed',  // <-- ADD THIS
      'whatif_work',
      // ... rest
    ] as const;
    ```

    2. Add swipe description to INTENT_CLASSIFICATION_PROMPT (in ACTIONS DISPONIBLES section):

    ```
    - show_swipe_embed: L'utilisateur veut voir/utiliser les stratégies swipe, explorer ses options d'action (mots clés: swipe, actions, stratégies, que puis-je faire, quelles options)
    ```

    Insert this line after 'show_energy_chart' in the prompt.
  </action>
  <verify>
    TypeScript compilation:
    ```bash
    cd packages/frontend && pnpm typecheck
    ```

    Verify SUPPORTED_ACTIONS includes 'show_swipe_embed':
    ```bash
    grep -n "show_swipe_embed" packages/frontend/src/lib/chat/intent/llmClassifier.ts
    ```
    Should show 2 occurrences: one in array, one in prompt.
  </verify>
  <done>
    LLM classifier recognizes 'show_swipe_embed' as a valid action and includes swipe intent description in prompt for context-aware classification.
  </done>
</task>

</tasks>

<verification>
All Phase 1 requirements satisfied:

1. **INTD-01**: "swipe" triggers swipe intent
   - Regex: `/^(?:swipe|actions?|stratégie?s?)[\s?!.]*$/i` matches "swipe"

2. **INTD-02**: "actions" triggers swipe intent
   - Regex: same pattern matches "actions"

3. **INTD-03**: "strategies" triggers swipe intent
   - Regex: same pattern matches "strategies" and "strategies"

4. **INTD-04**: "que puis-je faire?" triggers swipe intent
   - Regex: `/\b(?:que\s+puis[- ]?je\s+faire|quelles?\s+(?:options?|actions?|stratégies?))\b/i`

5. **INTD-05**: "quelles options" triggers swipe intent
   - Regex: same pattern matches "quelles options"

Run full verification:
```bash
cd /home/nico/code_source/perso/encode_club_hackathon_2026
pnpm typecheck
pnpm lint
```
</verification>

<success_criteria>
- [ ] `pnpm typecheck` passes with no errors
- [ ] `pnpm lint` passes (or only pre-existing warnings)
- [ ] detector.ts contains SWIPE_PATTERNS array
- [ ] detector.ts returns action: 'show_swipe_embed' for swipe patterns
- [ ] llmClassifier.ts SUPPORTED_ACTIONS includes 'show_swipe_embed'
- [ ] llmClassifier.ts prompt describes swipe intent for LLM context
</success_criteria>

<output>
After completion, create `.planning/phases/01-intent-detection/01-01-SUMMARY.md`
</output>
