---
phase: 21-integration
plan: 04
type: execute
wave: 1
depends_on: ["21-03"]
files_modified:
  - packages/frontend/src/components/tabs/GoalsTab.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "EarningsChart receives milestones data via props"
    - "Chart uses capacity-aware pace calculation (not linear fallback)"
  artifacts:
    - path: "packages/frontend/src/components/tabs/GoalsTab.tsx"
      provides: "EarningsChart with milestones prop"
      contains: "milestones={goalData.milestones()}"
  key_links:
    - from: "GoalsTab.tsx"
      to: "EarningsChart"
      via: "milestones prop"
      pattern: "milestones=\\{goalData\\.milestones\\(\\)\\}"
---

<objective>
Wire the milestones prop from GoalsTab to EarningsChart component.

Purpose: Close Gap 2 from VERIFICATION.md â€” EarningsChart accepts milestones prop but GoalsTab doesn't pass it. Without this wiring, the chart falls back to linear pace calculation instead of using capacity-aware milestones from retroplan.

Output: EarningsChart receives milestones data and can render capacity-aware pace line.
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-integration/21-VERIFICATION.md
@packages/frontend/src/components/tabs/GoalsTab.tsx
@packages/frontend/src/hooks/useGoalData.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add milestones prop to EarningsChart in GoalsTab</name>
  <files>packages/frontend/src/components/tabs/GoalsTab.tsx</files>
  <action>
At line 1304-1312, the EarningsChart component is rendered without the milestones prop.

Find:
```tsx
<EarningsChart
  goal={goals().find((g) => g.id === goalId)!}
  currency={currency()}
  adjustedWeeklyTarget={avgAdjustedTarget() ?? undefined}
  currentSaved={
    goalData.stats().totalEarned || followupData()?.currentAmount
  }
  weeklyEarnings={chartWeeklyEarnings()}
/>
```

Replace with:
```tsx
<EarningsChart
  goal={goals().find((g) => g.id === goalId)!}
  currency={currency()}
  adjustedWeeklyTarget={avgAdjustedTarget() ?? undefined}
  currentSaved={
    goalData.stats().totalEarned || followupData()?.currentAmount
  }
  weeklyEarnings={chartWeeklyEarnings()}
  milestones={goalData.milestones()}
/>
```

This is a one-line addition. The `goalData.milestones()` accessor already exists and returns `SimpleMilestone[]` (see useGoalData.ts line 497).
  </action>
  <verify>
1. `pnpm typecheck` passes (no type errors)
2. `pnpm lint` passes
3. Grep confirms wiring: `grep -n "milestones={goalData.milestones()}" packages/frontend/src/components/tabs/GoalsTab.tsx`
  </verify>
  <done>
EarningsChart receives milestones prop from goalData hook. Gap 2 from VERIFICATION.md is closed.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds: `pnpm typecheck`
2. Lint passes: `pnpm lint`
3. EarningsChart receives milestones: grep confirms the prop is passed
4. Frontend builds: `pnpm build:frontend`
</verification>

<success_criteria>
- [ ] EarningsChart component in GoalsTab receives `milestones={goalData.milestones()}`
- [ ] TypeScript compiles without errors
- [ ] Lint passes
- [ ] Gap 2 from 21-VERIFICATION.md is closed
</success_criteria>

<output>
After completion, create `.planning/phases/21-integration/21-04-SUMMARY.md`
</output>
