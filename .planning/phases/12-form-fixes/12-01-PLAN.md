---
phase: 12-form-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/src/components/chat/OnboardingChat.tsx
autonomous: true

must_haves:
  truths:
    - "Adding a subscription shows 'Netflix (€15/month)' format, not '[object Object]'"
    - "Adding an inventory item shows 'Old laptop (€50)' when profile currency is EUR"
    - "Adding a trade shows 'borrow Tent (saves £30)' when profile currency is GBP"
  artifacts:
    - path: "packages/frontend/src/components/chat/OnboardingChat.tsx"
      provides: "Fixed handleFormSubmit for lifestyle, inventory, trade steps"
      contains: "case 'lifestyle':"
    - path: "packages/frontend/src/components/chat/OnboardingChat.tsx"
      provides: "Dynamic currency formatting in inventory and trade messages"
      contains: "getCurrencySymbolForForm()"
  key_links:
    - from: "handleFormSubmit lifestyle case"
      to: "subscription array"
      via: "map with name and currentCost using prefix currency"
      pattern: "getCurrencySymbolForForm\\(\\).*sub\\.currentCost"
---

<objective>
Fix form data serialization and currency hardcoding in OnboardingChat.tsx

Purpose: Users completing onboarding should see properly formatted confirmation messages for subscriptions, inventory items, and trade opportunities, using their selected currency (not hardcoded $).

Output: Updated handleFormSubmit function that correctly formats dynamic-list fields
</objective>

<execution_context>
@/home/nico/.claude/get-shit-done/workflows/execute-plan.md
@/home/nico/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

Key file to modify:
@packages/frontend/src/components/chat/OnboardingChat.tsx

The bugs are in the `handleFormSubmit` function:
1. Line ~2339: `case 'lifestyle'` casts `data.subscriptions` as string - should map and format
2. Line ~2230: inventory message uses hardcoded `$` - should use `getCurrencySymbolForForm()`
3. Line ~2251: trade message uses hardcoded `$` - should use `getCurrencySymbolForForm()`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix lifestyle/subscriptions message formatting</name>
  <files>packages/frontend/src/components/chat/OnboardingChat.tsx</files>
  <action>
In the `handleFormSubmit` function, find the `case 'lifestyle':` block around line 2338.

Current code:
```typescript
case 'lifestyle':
  message = (data.subscriptions as string) || 'none';
  break;
```

Replace with proper array formatting:
```typescript
case 'lifestyle': {
  const subs = data.subscriptions as Array<{ name: string; currentCost?: number }>;
  if (Array.isArray(subs) && subs.length > 0) {
    message = subs
      .map((sub) => `${sub.name}${sub.currentCost ? ` (${getCurrencySymbolForForm()}${sub.currentCost}/month)` : ''}`)
      .join(', ');
  } else {
    message = 'none';
  }
  break;
}
```

This formats subscriptions like "Netflix (€15/month), Spotify (€10/month)" instead of "[object Object]".

Note: The `case 'lifestyle':` block already exists in the switch statement around line 2338. We replace the entire case block with the new logic (not adding a pre-switch handler).

Note: The "/month" suffix is intentionally hardcoded because all subscriptions in Stride are monthly by design (this is correct, not a bug).
  </action>
  <verify>TypeScript compiles: `pnpm --filter @stride/frontend typecheck`</verify>
  <done>Lifestyle step shows "Netflix (€15/month)" format in chat confirmation</done>
</task>

<task type="auto">
  <name>Task 2: Fix inventory message currency hardcoding</name>
  <files>packages/frontend/src/components/chat/OnboardingChat.tsx</files>
  <action>
In the `handleFormSubmit` function, find the inventory handling around line 2230.

Current code:
```typescript
.map((i) => `${i.name}${i.estimatedValue ? ` ($${i.estimatedValue})` : ''}`)
```

Replace with dynamic currency:
```typescript
.map((i) => `${i.name}${i.estimatedValue ? ` (${getCurrencySymbolForForm()}${i.estimatedValue})` : ''}`)
```

This uses the profile's currency symbol with prefix position (EUR -> "Old laptop (€50)", GBP -> "Old laptop (£50)").
  </action>
  <verify>TypeScript compiles: `pnpm --filter @stride/frontend typecheck`</verify>
  <done>Inventory items display with profile currency symbol in chat message</done>
</task>

<task type="auto">
  <name>Task 3: Fix trade message currency hardcoding</name>
  <files>packages/frontend/src/components/chat/OnboardingChat.tsx</files>
  <action>
In the `handleFormSubmit` function, find the trade handling around line 2251.

Current code:
```typescript
`${t.type} ${t.description}${t.withPerson ? ` from ${t.withPerson}` : ''}${t.estimatedValue ? ` (saves $${t.estimatedValue})` : ''}`
```

Replace with dynamic currency:
```typescript
`${t.type} ${t.description}${t.withPerson ? ` from ${t.withPerson}` : ''}${t.estimatedValue ? ` (saves ${getCurrencySymbolForForm()}${t.estimatedValue})` : ''}`
```

This uses the profile's currency symbol for trade savings display.
  </action>
  <verify>TypeScript compiles: `pnpm --filter @stride/frontend typecheck`</verify>
  <done>Trade opportunities display with profile currency symbol in chat message</done>
</task>

</tasks>

<verification>
1. Run typecheck to ensure no TypeScript errors: `pnpm --filter @stride/frontend typecheck`
2. Manual verification (dev server):
   - Start with `pnpm dev`
   - Complete onboarding to the lifestyle step
   - Add a subscription (e.g., "Netflix, 15")
   - Verify chat shows "Netflix (€15/month)" not "[object Object]"
   - For currency test: Start fresh onboarding in a European city (Paris)
   - Verify inventory/trade items show EUR symbol
</verification>

<success_criteria>
- [ ] TypeScript compiles without errors
- [ ] Subscription additions show formatted name and cost in chat
- [ ] Inventory items use profile currency symbol (not hardcoded $)
- [ ] Trade opportunities use profile currency symbol (not hardcoded $)
- [ ] All three requirements FORM-01 and FORM-02 addressed
</success_criteria>

<output>
After completion, create `.planning/phases/12-form-fixes/12-01-SUMMARY.md`
</output>
