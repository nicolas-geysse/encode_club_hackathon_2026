# Milestone v4.0: Goals Tab Fix

**Status:** SHIPPED 2026-02-02
**Phases:** 20-23
**Total Plans:** 9

## Overview

Unified the Goals tab calculation systems and fixed data consistency issues through architectural refactoring. Two parallel calculation systems (capacity-aware in WeeklyProgressCards, linear in EarningsChart) were creating user confusion. A centralized hook now ensures consistency across all components.

**Reference:** [docs/bugs-dev/goals-fix.md](../../docs/bugs-dev/goals-fix.md)

## Phases

### Phase 20: Foundation

**Goal**: Establish typed data structures and hook skeleton that will centralize all goal data orchestration
**Depends on**: Nothing (milestone start)
**Plans**: 1 plan

Plans:
- [x] 20-01: Create EarningEvent types and useGoalData hook skeleton

**Key Files Created:**
- `packages/frontend/src/types/earnings.ts` (111 LOC)
- `packages/frontend/src/hooks/useGoalData.ts` (skeleton)

### Phase 21: Integration

**Goal**: Complete the useGoalData hook with real data fetching and rewire all components to use it as single source of truth
**Depends on**: Phase 20
**Plans**: 4 plans

Plans:
- [x] 21-01: Complete useGoalData hook implementation with data fetching
- [x] 21-02: Integrate useGoalData into GoalsTab and wire to EarningsChart
- [x] 21-03: Convert WeeklyProgressCards to pure display component
- [x] 21-04: Wire milestones prop to EarningsChart for capacity-aware pace

**Key Files Created:**
- `packages/frontend/src/lib/earningsAggregator.ts` (326 LOC)

**Key Files Modified:**
- `packages/frontend/src/hooks/useGoalData.ts` (601 LOC final)
- `packages/frontend/src/components/tabs/GoalsTab.tsx`
- `packages/frontend/src/components/WeeklyProgressCards.tsx`
- `packages/frontend/src/components/EarningsChart.tsx`

### Phase 22: Calculation Unification

**Goal**: Unify status calculation with configurable thresholds shared across all components
**Depends on**: Phase 21
**Plans**: 2 plans

Plans:
- [x] 22-01: Create goalStatus.ts with GOAL_STATUS_THRESHOLDS constant
- [x] 22-02: Import shared thresholds in WeeklyProgressCards

**Key Files Created:**
- `packages/frontend/src/lib/goalStatus.ts` (107 LOC)

### Phase 23: UX Polish

**Goal**: Fix avatar display issues and improve label clarity with tooltips
**Depends on**: Phase 22
**Plans**: 2 plans

Plans:
- [x] 23-01: Fix avatar positioning in WeeklyProgressCards
- [x] 23-02: Add stat label tooltips and chart legend

**Key Changes:**
- Avatar `pt-8` padding + inside-card positioning
- Native HTML title attributes for tooltips
- Chart legend with colored line samples
- Consistent status colors across components

---

## Milestone Summary

**Key Decisions:**
- Centralized `useGoalData` hook over scattered calculations (Rationale: Single source of truth)
- `earningsAggregator` for date-attributed earnings (Rationale: Proper week assignment)
- Configurable `GOAL_STATUS_THRESHOLDS` constant (Rationale: Easy tuning, consistency)
- Native HTML tooltips over library (Rationale: No dependencies, accessibility built-in)

**Issues Resolved:**
- Two parallel calculation systems causing inconsistent status display
- Earnings attributed to wrong weeks
- Avatar cut off on mobile
- Chart legend missing

**Technical Debt Incurred:**
- None significant

---

_For current project status, see .planning/ROADMAP.md_
